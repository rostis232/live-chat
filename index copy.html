<div class="m-3 shadow rounded bg-light">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://unpkg.com/htmx.org@1.9.11" integrity="sha384-0gxUXCCR8yv9FM2b+U3FDbsKthCI66oH5IA9fHppQq9DDMHuMauqq1ZHBpJxQ0J0" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/htmx.org@1.9.11/dist/ext/ws.js"></script>
    <script src="https://kit.fontawesome.com/f7b7832cac.js" crossorigin="anonymous"></script>
    <script>
        var errorCount = 0;

        document.addEventListener('htmx:wsError', function(event) {
            errorCount++;
            if (errorCount >= 5) {
                var error = event.detail.error;
                var errorMessageElement = document.getElementById('error-message');
                errorMessageElement.textContent = 'Помилка чату: зачекайте або оновіть сторінку (' + error.message + ')';
                errorMessageElement.style.display = 'block';
            }
        });

        document.addEventListener('htmx:wsOpen', function(event) {
            errorCount = 0;
            var errorMessageElement = document.getElementById('error-message');
            errorMessageElement.style.display = 'none';
        });
    </script>
    <script>
        function timeSince(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            let interval = Math.floor(seconds / 86400);
        
            if (interval > 1) {
                return interval + " дні назад";
            }
            interval = Math.floor(seconds / 3600);
            if (interval > 1) {
                return interval + " години назад";
            }
            interval = Math.floor(seconds / 60);
            if (interval > 1) {
                return interval + " хвилини назад";
            }
            return "Тільки що";
        }
        
        function updateTimeSince() {
            const dateElement = document.getElementById("date");
            const dateString = dateElement.textContent;
            const dateParts = dateString.split(/[\s.:]+/);
            const date = new Date(dateParts[2], dateParts[1] - 1, dateParts[0], dateParts[3], dateParts[4], dateParts[5]);
            dateElement.textContent = timeSince(date);
        }
        
        // Оновлюємо час один раз при завантаженні сторінки
        updateTimeSince();
        
        // Оновлюємо час кожну хвилину
        setInterval(updateTimeSince, 60000);
        </script>
    <style>
        /* Встановлення фіксованої висоти для блоку */
        .fixed-height-block {
          height: 60vh; /* Максимальна висота екрану */
          overflow-y: auto; /* Додавання вертикального повзунка у випадку перевищення висоти */
        }
    </style>
    <form hx-post="http://localhost:1323/send" class="border-start-0">
        <div class="input-group border-right-0">
            <input type="text" name="name" id="name" class="form-control col-1 border-right-0" placeholder="Name" required><br>
            <input type="text" name="text" id="text" class="form-control border-right-0" placeholder="Text" required><br>
            <button type="submit" class="btn border-right-0 btn-outline-primary">
                <span class="icon text-white-50">
                    <i class="fas fa-trash"></i>
                </span>
            </button>
        </div>
    </form>
    <div hx-ext="ws" ws-connect="ws:localhost:1323/ws">
        <div class="col fixed-height-block" id="chat_room">
            <div class="col fixed-height-block p-3" id="notifications"></div>
        </div>
    </div>
</div>